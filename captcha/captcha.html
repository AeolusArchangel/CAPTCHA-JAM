<!doctype html>
<html lang='en'>
<head>
  <meta charset='utf-8'>
  <title>CPS BOT Checker</title>
  <meta name='viewport' content='width=device-width, initial-scale=1'>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,500;1,500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Quantico">
    <audio id='sfxError' src='sfx/error.mp3' type='audio/mpeg'></audio>
    <audio id='sfxWin' src='sfx/success.mp3' type='audio/mpeg'></audio>
    <audio id="sfxBot" src="sfx/dialup.mp3" type="audio/mpeg"></audio>
    <audio id='C'  src='sfx/piano/c.mp3' type='audio/mpeg'></audio>
    <audio id='C2' src='sfx/piano/c2.mp3' type='audio/mpeg'></audio>
    <audio id='D'  src='sfx/piano/d.mp3' type='audio/mpeg'></audio>
    <audio id='D2' src='sfx/piano/d2.mp3' type='audio/mpeg'></audio>
    <audio id='E'  src='sfx/piano/e.mp3' type='audio/mpeg'></audio>
    <audio id='F'  src='sfx/piano/f.mp3' type='audio/mpeg'></audio>
    <audio id='F2' src='sfx/piano/f2.mp3' type='audio/mpeg'></audio>
    <audio id='G'  src='sfx/piano/g.mp3' type='audio/mpeg'></audio>
    <audio id='G2' src='sfx/piano/g2.mp3' type='audio/mpeg'></audio>
    <audio id='A'  src='sfx/piano/a.mp3' type='audio/mpeg'></audio>
    <audio id='A2' src='sfx/piano/a2.mp3' type='audio/mpeg'></audio>
    <audio id='B'  src='sfx/piano/b.mp3' type='audio/mpeg'></audio>
<style type='text/css'>
    html,
    body {
      background: rgb(0, 0, 0);
      margin: 0;
      padding: 0;
      font-family: sans-serif;
      overflow: hidden;
    }
    img {
      width: 100%;
      height: auto;
    }
   /* Confetti CSS Generated by AI, modifications by suggestions afterwards*/
    #confetti-container {
      pointer-events: none;
      position: absolute;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      z-index: 9999;
      overflow: hidden;
    }
    .confetti {
      position: absolute;
      width: 6px;
      height: 12px;
      opacity: 1;
      will-change: transform;
      border: none;
      /* Solid color, no gradient */
      background: currentColor;
      /* Bright drop shadow for pop effect */
      box-shadow: 0 2px 8px 2px rgba(0, 0, 0, 0.25);
      /* Remove blend mode for solid look */
      mix-blend-mode: normal;
      transition: filter 0.2s, transform 2.5s;
      perspective: 400px;
    }
    /* Custom Loading circle  effect*/
    .loading {
      --a: 180deg; /* control the progression */
      width: 100px;
      aspect-ratio: 1;
      padding: 18px; /* the border thickness */
      box-sizing: border-box;
      border-radius: 100%;
      background: rgba(255, 255, 255, 0);
      mask:
        linear-gradient(#0000 0 0) content-box intersect,
        conic-gradient(#000 var(--a),#1110  );
    }
    @keyframes loading{
      from{transform: rotate(0deg);}
      to{transform: rotate(360deg);}
    }
    #loading {
     background: rgba(37, 190, 255, 0.716);
      width: 100px;
      height: 100px;
      top: 100px;
      left: 145px;
      position: absolute;
      animation: loading 2s infinite;
      animation-timing-function: linear;
      display: none;
    }
    #captcha-container {
      background: rgb(22, 121, 186);
      width: 390px;
      height: 300px;
      display: block;    
    }
    .title {
      font-family: "Montserrat", sans-serif;
      font-optical-sizing: auto;
      font-weight: 500;
      font-style: normal;
    }
    #title {
      background: rgb(22, 121, 186);
      width: 100%;
      height: 100%;
      padding-top: 10px;
      text-align: center;
      color: white;
      font-size: 25px;
      user-select: none;
      position: static;
      display: block;
    }
    .numbers {
      background: rgb(30, 30, 30);
      font-family: 'Quantico', sans-serif;
      text-shadow: 0px 0px 0px #ffffff;
      text-align: center;
      font-size: 70px;
      height: 108px;
      width: 370px;
      margin-left: 10px;
      user-select:none;
      position: static;
      display: block;
      box-sizing: border-box;
      border: 5px groove white;
    }
    #target{
      margin-top: 10px;
      color: rgba(255, 255, 255, 0);
      border-radius: 10px 10px 0px 0px;
      padding-top: 0px;
      border-bottom: none;
    }
    #targetNo{
      transform: skew(0deg, 0deg);
      pointer-events: none;
    }
    #count {
      text-shadow: 0px 0px 0px #ffffff;
      color: rgba(255, 255, 255, 0);
      border-top: none;
      box-shadow: none;
    }
    #progContainer {
      background: #ffffff;
      width: 370px;
      margin-left: 10px;
      user-select:none;
      padding: none;
      height: auto;
      position: static;
      display: block;
      border-radius: 0px 0px 10px 10px;
    }
    #progress {
      background: rgb(67, 172, 67);
      width: 0%;
      height: 25px;
      border: none;
      position: static;
      display: block;
    }
    @keyframes progress {
      from {opacity: 30%}
      to {opacity: 100%}
    }
    #progAnimate {
     background: linear-gradient(to left, rgba(0, 0, 0, 0), rgba(107, 255, 88),rgba(0, 0, 0, 0));
     /*background: linear-gradient(to left, rgba(0, 0, 0, 0), rgb(206, 195, 0),rgba(0, 0, 0, 0)); */
      height: 25px;
      width: 100%;
      border: none;
      position: static;
      display: block;
      animation: progress infinite alternate;
      animation-duration: 2s;
      animation-timing-function: ease-in-out;
    }
    .botClass {
      font-family: 'Quantico', sans-serif;
      max-width: 100%;
      color: white;
      text-align: center;
      user-select: none;
      position: relative;
    }
    #BotDetected{
      z-index: 5;
      background-image: url('img/matrix.gif');
      width: 390px;
      height: 300px;
      display: none;
      position: absolute;
    }
    #robotAngry {
      z-index: 6;
      display: block;
      position: absolute;
      width: 390px;
      height: 300px;
      background-size: 200px;
      background-repeat: no-repeat;
      background-position: center;
      background-image: url('img/robotAngry.png'); /* Image from Freep!k - User @user5923591 https://www.freepik.com/author/user5923591/icons */
    }
    span {
      border: 5px solid;
      border-color: rgba(0, 196, 46, 0.55);
      box-shadow: 0px 0px 8px rgba(0, 255, 60, 0.65);
      background-color: rgba(20, 20, 20, 0.75);
      padding: 4px 4px;
      }
    #botMessage {
      z-index: 7;
      height: 205px;
      font-size: 34px;
      padding-top: 20px;
    }
    #timer{
      background: linear-gradient(rgba(0, 0, 0, 0), rgb(0, 0, 0));
      height: 75px;
      font-size: 50px;
      top: 0%;
    }
    #notes{
      background: rgb(30, 30, 30);
      background-image: url('img/note.png');
      background-blend-mode: lighten;
      background-position: center;
      background-repeat: no-repeat;
      background-size: 25px 25px;
      color: #ffffff;
      height: 30px;
      Width: 40px;
      font-family: "Montserrat", sans-serif;
      font-optical-sizing: auto;
      font-weight: 500;
      font-size: 24px;
      text-align: center;
      text-shadow: 2px 2px #000;
      top: 0%;
      position: absolute;
      display: none;
      top: 10px;
      left: 18px;
      padding: 1px;
      border-radius: 6px;
      border: 2px outset rgb(255, 255, 255);
    }
    .inner-curve {
      --r: 0px; /* the radius */
      --s: 10px; /* size of inner curve */
      --x: 14px; /* horizontal offset (no percentage) */
      --y: 17px; /* vertical offset (no percentage) */

      position: absolute;
      bottom: 0px;
      z-index: 20;
      
      width: 34px;
      aspect-ratio: 1;
      background: rgb(22, 121, 186);

    }
    #curve-left{
      display: block;
      left: 0px;
        border-radius: var(--r);
      --_m:/calc(2*var(--r)) calc(2*var(--r)) radial-gradient(#000 70%,#0000 72%);
      --_g:conic-gradient(at calc(100% - var(--r)) var(--r),#0000 25%,#000 0);
      --_d:(var(--s) + var(--r));
      mask:
        calc(100% - var(--_d) - var(--x)) 0 var(--_m),
        100% calc(var(--_d) + var(--y)) var(--_m),
        radial-gradient(var(--s) at 100% 0,#0000 99%,#000 calc(100% + 1px)) 
        calc(-1*var(--r) - var(--x)) calc(var(--r) + var(--y)),
        var(--_g) calc(-1*var(--_d) - var(--x)) 0,
        var(--_g) 0 calc(var(--_d) + var(--y));
      mask-repeat: no-repeat;
    }
    #curve-right{
      display: block;
      right: -1px;
        border-radius: var(--r);
      --_m:/calc(2*var(--r)) calc(2*var(--r)) radial-gradient(#000 70%,#0000 72%);
      --_g:conic-gradient(at var(--r) var(--r),#000 75%,#0000 0);
      --_d:(var(--s) + var(--r));
      mask:
        calc(var(--_d) + var(--x)) 0 var(--_m),
        0 calc(var(--_d) + var(--y)) var(--_m),
        radial-gradient(var(--s) at 0 0,#0000 99%,#000 calc(100% + 1px)) 
        calc(var(--r) + var(--x)) calc(var(--r) + var(--y)),
        var(--_g) calc(var(--_d) + var(--x)) 0,
        var(--_g) 0 calc(var(--_d) + var(--y));
      mask-repeat: no-repeat;
    }
</style>
</head>
<body>
  <div id='BotDetected'>
    <div id ="robotAngry"></div>
    <div class="botClass" id='botMessage'><span>BOT DETECTED!</span><br><br><br><span>Time left until reset</span></div>
    <div class="botClass" id='timer'>NaNs</div>
  </div>
  <div id='captcha-container'>
    <div class="title" id='title'>Match the numbers 
      <div id="confetti-container"></div>
      <div id='notes'></div>
      <div id ="loading" class="loading"></div>
      <div class="numbers" id='target'><div id="targetNo"></div></div>
      <button class="numbers" id='count' onclick='buttonClick();'></button>
      <div id="progContainer">
        <div id='progress'>
          <div id="progAnimate"></div>
        </div>
      </div>      
    </div> 
    <div class="inner-curve" id ="curve-left"></div>
    <div class="inner-curve" id ="curve-right"></div>
  </div>
 <!-- TO DO / IDEAS: 
  - Change difficulty through keyboard press 
 -->
<script type='text/javascript'>
  // Difficulty - 0 = Custom (Edit below not in the SWITCH case), 1 = Easy , 2 = Med, 3 = Hard
    let difficulty = 3;                     // Set difficulty 
    // Custom difficulty variables
    let IHighest = 5;                     // Higher starting randomised number
    let Ilowest = 5;                     // Lower target randomised number
    let Irange = 1;                     // Minimum clicks between randomised numbers | 26 = Piano Astley & sillysounds = true
    let IGame = 2;                     // Set amount of games to complete before 'winning' | 0 = 1 game
    let MaxCPS = 10;                  // Max clicks per second - Average 4-7 - Lower triggers bot detect screen more | Test CPS here https://clickspeedtest.com
    let Ctimer = 10;                 // Time on the countdown timer in seconds | Time left before reseting the captcha
    let Mblur = 15;                 // Set max blur amount of target number. 20 = Pushing legibility limit  
    let barSpeed = 100;            // Speed of progress bar updating in miliseconds 200 = 0.2s
    let BTimeout = 1000;          // Minumm Timeout length after countdown reaches 0 - in Miliseconds | 1s = 1000
    let RndmGame = false;        // Enable Random amount of games | Change Igame
  // Boolean Variables - Other fun changes
    let pride = true;          // Change the progress bar to Rainbowmode
    let sillySounds = false;  // Toggle silly sound effects | Random Piano notes each click
    let skewTarget = true;   // Enables the target number to be skewed randomly

  // Initialised variables - DO NOT CHANGE
    let target = 0;                          // Target number to 'win'
    let total = 0;                          // Total clicks remaining to target
    let game = 0;                          // Games finished to win | counter
    let RGame = 0;                        // Stores randomises game amount
    let highestNumber = 0;               // Highest no. to randomise
    let lowestNumber = 0;               // Lowest no. to randomise
    let range = 0;                     // minimum Range between highest & Lowest
    let prog = 0;                     // Progress of captcha - green bar at 'extreme' bottom of captcha
    let ress = 0;                    // Gets value for progress bar
    let cps = 0;                    // Clicks per second
    let check = false;             // Boolean to start/stop timing to check for cps
    let i = 0;                    // Looping integer for Piano music
    let w = 0;                   // Counter for typing win
    let LastKey = '';           // Stores the last key press
    let Blur = 0;              // Blur value for total
    let STotal = 0;           // Stores starting total
    let m = 0;               // Stores a random value for percentage if a song will play
    let m2 = 0;             // Stores a random value for which song should play

    // Audio SFX - Note melodies from https://noobnotes.net/
    let SRCString = 'C';    // Stores custom ID source for the random piano notes
    const piano = ['C','C2','D','D2','E','F','F2','G','G2','A','A2','B']; // 12 Note for 1 Octave
    const pianoAstley = ['C','D','F','D','G','G','F','E','D','C','D','F','D','F','G','E','C','C','G','F']; // 20 Notes
    const pianoBabyShark = ['D','E','G','G','G','G','G','G','G','D','E','G','G','G','G','G','G','G','D','E','G','G','G','G','G','G','G','G','G','F2']; // 30 Notes
    const pianoHappyBday = ['C','C','D','C','F','E','C','C','D','C','G','F','C','C','A2','C','F','E','D','A2','A2','A','F','G','F']; // 26 Notes
    const pianoClapHands = ['C','C','F','F','F','F','F','F','E','F','G','C','C','G','G','G','G','G','G','F','G','A','F','F','A2','A2','A2','A2','D','D','A2','A2','A','A','A','G','F','F','A','A','G','G','G','F','E','E','D','E','F']; // 49 Notes
    const pianoBeatlesSun = ['B','G','A','B','B','A','G','E','G','A','G','E','D','B','G','A','B','B','A','G','E','B','A','G','F2','B','A','B','G','B','G','A','B','B','A','B','G','E','B','A','G','B','A','G']; // 45 Notes
    const pianoAI = ['C','C2','C','C2','D','D2','D','D2','F','F2','F','F2','B','C','B','C2','B','C','B','C2','G','G2','G','G2','A','A2','A','A2','E','F','E','F']; // AI Generated melody - Suggested to be Annoying

  randomiseNumbers(total,target);  // Randomise the two numbers, Max & minimum to 'WIN'
  displayNumbers(target,total);   // Displays new randomised numbers
  m = Math.random();             // Stores Random number % 0.0 - 1.0 - chance of a song to play otherwise random notes
  m2 = Math.random();           // Second Random number for selecting song to play by piano

  // Randomises amount of games to win with a minimum of 1
  if (RndmGame == false) {
      ress = (1/(IGame + 1))*100; // Calculates ress = progress bar calculations
    }else{
      RndmGame = false;
      RGame = Math.floor(Math.random() * IGame) + 1;
      ress = (1/RGame)*100;
      IGame = RGame - 1;
    }

// Enables rainbow progress bar when current Month is June or if Pride = true
  const date = new Date();       // Stores current date       
  let month = date.getMonth();  // Stores current month
  // month = 11; // Test to see different seasonal progress bars | Jan = 0 to Dec = 11
  if (month == 5 && pride == true){
      document.getElementById('progress').style.background = "linear-gradient(red,orange,yellow,green,blue,indigo,violet)";
      document.getElementById('progAnimate').style.background = "linear-gradient(rgba(0, 0, 0, 0), rgba(107, 255, 88),rgba(0, 0, 0, 0))";
      document.getElementById('progAnimate').style.animationDuration = "3.5s";
  }
  // Halloween - Orange & black - Spooky void
  if (month == 9){
    document.getElementById('progress').style.background = 'linear-gradient(orange,black, orange)';
    document.getElementById('progAnimate').style.background = "linear-gradient(rgba(0, 0, 0, 0), rgba(0, 0, 0, 1),rgba(0, 0, 0, 0))";
  }

  // Winter Holiday - Red, red & white - Crimbas Hat
  if (month == 11){
    document.getElementById('progress').style.background = 'linear-gradient(rgb(202, 27, 27), rgb(202, 27, 27), white)';
    document.getElementById('progAnimate').style.background = "linear-gradient(rgb(202, 27, 27),rgb(202, 27, 27), rgb(202, 27, 27), white, white)";
  }

// TEST CODE - Press 'b' to toggle the bot detection screen
let bot = false; // When to show the bot detected screen
document.addEventListener('keydown', (event) => {
    if (event.key == 'b' && bot == false){
      document.getElementById('BotDetected').style.display = 'block';
        document.getElementById('curve-left').style.display = 'none'; // hides the sides of progress bar
        document.getElementById('curve-right').style.display = 'none'; // hides the sides of progress bar
        bot = true;
      if(sillySounds == true){
        playAudioError();
      }
    } else if(event.key == 'b' && bot == true){
      document.getElementById('BotDetected').style.display = 'none';
      bot = false;
    }});

// TEST CODE - Press 'q' - increase Blur effect on target number 
document.addEventListener('keydown', (event) => {
    if (event.key == 'q'){
        if(Blur >=20){
        Blur = 0;
        document.getElementById('targetNo').style.textShadow = "0px 0px " + Blur +"px #ffffff";
    } else {
        Blur = Blur + 2;
        document.getElementById('targetNo').style.textShadow = "0px 0px " + Blur +"px #ffffff";
    }
  }});
// TEST CODE - Press r to reset the captcha
document.addEventListener('keydown', (event) => {
    if (event.key == 'r'){
      resetGame();       
    }
  });

// Disables F5 - refresh
document.addEventListener('keydown', (e) => {
    e = e || window.event;
    if(e.keyCode == 116){
        e.preventDefault();
    }});
   
// Press ( W i n ) in the correct order to win the captcha
document.addEventListener('keydown', (event) => {
  // If wrong key after 'w', reset
  if(event.key != 'i' && LastKey == 'w'){ 
    LastKey = "";
    w = 0;
  // If wrong key after 'i', reset
  } else if (event.key != 'n' && LastKey == 'i'){
    LastKey = "";
    w = 0;
  }
  // If 'w' pressed first, increment win sequence
  if (event.key == 'w' && LastKey == ""){
    w++;
    LastKey = 'w';
  }
  // If 'i' pressed after 'w', increment win sequence
  if (event.key == 'i' && w == 1 && LastKey == 'w'){
    w++;
    LastKey = 'i';
  }
  // If 'n' pressed after 'w' and 'i', trigger win
  if (event.key == 'n' && w == 2 && LastKey == 'i'){
    win();
  }});

// Press 's' to toggle silly sounds on/off
document.addEventListener('keydown', (event) => {
  if (event.key == 's' && sillySounds == false){
    sillySounds = true;
  } else if(event.key == 's' && sillySounds == true){
    sillySounds = false;
    document.getElementById('notes').style.display = 'none';
  }});

// MAIN PROGRAM
// Button click event - Handles main game logic
function buttonClick() {
  total--;      
  displayNumbers();  // Updates the displayed numbers

  // Play sound effects if enabled
  if (sillySounds == true){
    document.getElementById('notes').style.display = 'block';
    // 20% chance to play a song, otherwise play a random note
    if (m <= 0.2){
      /**/ // Each song has a 16.66% chance to play
      if(m2 <= 0.166 ){
        playBabyShark();
      } else if (m2 <= 0.332){
        playClapHands();
      } else if (m2 <= 0.499){
        playAI();
      } else if (m2 <= 0.666){
        playBeatlesSun();
      } else if (m2 <= 0.833){
        playHappyBday();
      } else if (m2 <= 1){
        playAstley();
      }
    } else if (m >= 0.21){
      playPiano(SRCString);
    }
  }

  // Start CPS timer on first click
  if(check == false){
    startTime = performance.now();
    check = true;
  }
  // If user matches the target and hasn't finished all games
  if (total == target && game < IGame){
    cpsCheck(cps);   // Calculates time between clicks
    check = false;   // Stop timer
   // document.getElementById('count').innerHTML = cps; // Show CPS for testing
    if(cps <= MaxCPS){
      // If last game, win & under CPS max
      if (total == target && game == IGame) {
        win(); // Completes the captcha - WIN
      }
      update(prog,ress); // Updates variables and green progress bar
    } else if (cps > MaxCPS){
      botCheck(); // Show bot detected screen / resets captcha back to start
    }
  // If last game, check for win or bot
  } else if (total == target && game == IGame){
    cpsCheck(cps);
    check = false;
    if (cps <= MaxCPS){
      GreenBar(prog,ress); // Updates green bar until 100% then completes captcha
    } else if (cps > MaxCPS){
      botCheck();
    }}}

//Audio/Sound effects Functions
// Play Error audio
function playAudioError(){
  document.getElementById('sfxError').play();
}

// Plays a random note on the Piano - 1 Octave
function playPiano(SRCString){ 
  let audioSRC = Math.floor(Math.random() * piano.length);
  SRCString = piano[audioSRC];
  let audio = document.getElementById(SRCString);
  audio.cloneNode().play(); // Allows to play sounds in quick succession
  WhichNote(SRCString);
} 

// Plays never gonna give you up - Tempo by click speed - Piano by user
function playAstley(SRCString){ 
  if (i >= pianoAstley.length - 1){ 
    i= 0;
  } else {
    i++;
    SRCString = pianoAstley[i];
    let audio = document.getElementById(SRCString);
    audio.cloneNode().play();
    WhichNote(SRCString);
  }
}

function playAI(SRCString){ 
  if (i >= pianoAI.length - 1){ 
    i= 0;
  } else {
    i++;
    SRCString = pianoAI[i];
    let audio = document.getElementById(SRCString);
    audio.cloneNode().play();
    WhichNote(SRCString);
  }
}

// Plays Baby Shark - Tempo by click speed - Piano by user
function playBabyShark(SRCString){
  if (i >= pianoBabyShark.length - 1){
    i= 0;
  } else {
    i++;
    SRCString = pianoBabyShark[i];
    let audio = document.getElementById(SRCString);
    audio.cloneNode().play();
    WhichNote(SRCString);
  }
}

// Plays Happy Birthday - Tempo by click speed - Piano by user
function playHappyBday(SRCString){
  if (i >= pianoHappyBday.length - 1){
    i= 0;
  } else {
    i++;
    SRCString = pianoHappyBday[i];
    let audio = document.getElementById(SRCString);
    audio.cloneNode().play();
    WhichNote(SRCString);
  }
}

// Plays Clap your hands - Tempo by click speed - Piano by user
function playClapHands(SRCString){
  if (i >= pianoClapHands.length - 1){
    i= 0;
  } else {
    i++;
    SRCString = pianoClapHands[i];
    let audio = document.getElementById(SRCString);
    audio.cloneNode().play();
    WhichNote(SRCString);
  }
}

// Plays Beatles - Here Comes the Sun - Tempo by click speed - Piano by user
function playBeatlesSun(SRCString){
  if (i >= 44){
    i= 0;
  } else {
    i++;
    SRCString = pianoBeatlesSun[i];
    let audio = document.getElementById(SRCString);
    audio.cloneNode().play();
    WhichNote(SRCString);
  }
}

// Display which piano note has been played
function WhichNote(SRCString){
  switch (SRCString){
    case 'C2':
      document.getElementById('notes').innerHTML = 'C#';
      break;
    case 'D2':
      document.getElementById('notes').innerHTML = 'D#';
      break;
    case 'F2':
      document.getElementById('notes').innerHTML = 'F#';
      break;
    case 'G2':
      document.getElementById('notes').innerHTML = 'G#';
      break;
    case 'A2':
      document.getElementById('notes').innerHTML = 'A#';
      break;
    case '': // Keeps previous note displayed - Does not display 'undefined' as text
      break;
    default:
      document.getElementById('notes').innerHTML = SRCString;
      break;
  }
}

// Update next game state and visuals
function update(){
  i= 0;
  m = Math.random();
  m2 = Math.random();
  GreenBar(); // Updates progress of games completed with a green progress bar
  game++;
}

// Green Progress bar - Calculates progress - then updates visual variables once finished loading
function GreenBar(){
  document.getElementById('count').style.color = 'rgb(67, 172, 67)';  // Turns the target no. green upon match
  let width = prog;
  prog = prog + ress + (Math.floor(Math.random() * (10 - -10)))+ -10; //  Adds up Progress for the green bar
  document.getElementById("loading").style.display = "block";
  document.getElementById('progAnimate').style.display = 'block'; // shows the green bar animation
  document.getElementById('curve-left').style.display = 'block'; // Shows sides of progress bar
  document.getElementById('curve-right').style.display = 'block'; // Shows sides of progress bar
  document.getElementById('count').disabled = true;
  // updates green bar length
  var id = setInterval(frame, barSpeed);
  function frame() {
    if (width >= prog){
      if(width >= 100){
        clearInterval(id);
         win();
      } else {
        clearInterval(id);
        document.getElementById("loading").style.display = "none";
        document.getElementById('count').disabled = false;
        document.getElementById('count').style.color = 'rgba(255, 255, 255, 0)';
        randomiseNumbers(); // Resets randomised numbers for next game 
        skewTargetNumber();
        blurNumber();
        displayNumbers();
      }
    } else{
      width = width + Math.random()*3;
      document.getElementById('progress').style.width = width + '%';
      document.getElementById('count').disabled = true;
    }}}

// Difficulty enforcer - sets the difficulty variables
function getdifficulty(){
  switch (difficulty) {
  case 1:
      IHighest = 15;
      Ilowest = 5;
      Irange = 5;
      IGame = 2;
      Mblur = 5;
      barSpeed = 100;
      MaxCPS = 7.5;
      Ctimer = 10;
    break;
  case 2:
      IHighest = 20;
      Ilowest = 15;
      Irange = 10;
      IGame = 3;
      Mblur = 10;
      barSpeed = 150;
      MaxCPS = 6;
      Ctimer = 15;
    break;
  case 3:
      IHighest = 50;
      Ilowest = 10;
      Irange = 25;
      IGame = 4;
      Mblur = 15;
      barSpeed = 200;
      MaxCPS = 4;
      Ctimer = 20;
      sillySounds = true;
    break;
  default:
    break;
}
  highestNumber = IHighest;  // Sets highest range no. 
  lowestNumber = Ilowest;   // Sets target range number to 'win'
  range = Irange;          // Sets Minimum range between starting no. and winning no.
}

// Randomise numbers for the game
function randomiseNumbers(){
  getdifficulty(highestNumber,lowestNumber,range); // Passes the difficulty variables to calculate new randomised numbers
  total = Math.floor(Math.random() * highestNumber) + lowestNumber + range; // Randomises the total - Higher
  target = Math.floor(Math.random() * lowestNumber); // Randomises the target number - Lower
  STotal = total; // Stores the starting total 
}

// Display target number and total number
function displayNumbers(){
  document.getElementById('count').innerHTML = total;       // Displays Total number of clicks to 'win'
  document.getElementById('targetNo').innerHTML = target ;  // Displays the target number to Win
}  

// Randomises the skewing angles for target number
function skewTargetNumber(){
  if(skewTarget == true){
    let xAngle = Math.floor(Math.random() * (75 - -70 + 1)) + -70;
    let yAngle = Math.floor(Math.random() * (35 - -35 + 1)) + -35;
    document.getElementById('targetNo').style.transform = "skew(" + xAngle + "deg, " + yAngle + "deg)";
  }
}

// Randomises the Blur for the target number from 0px - 20px - 1st game always has no blur
function blurNumber(){
  if (prog == 0){
    document.getElementById('targetNo').style.textShadow = "0px 0px 0px #ffffff";
  } else {
    Blur = Math.floor(Math.random() * Mblur);
    document.getElementById('targetNo').style.textShadow = "0px 0px " + Blur +"px #ffffff";
  }
}

// Calculates time between Clicks
function cpsCheck(){
  endTime = performance.now();           // Stops timer and stores value
  let seconds = (endTime - startTime);      // Calculate seconds to complete 1 game
  // cps = seconds;
  cps = STotal / (seconds / 1000);   // Calculates Clicks per second - average 4-6
  cps = Number((cps).toFixed(2));     // Stores cps value with 2 decimal places | 5.55
}

// Bot Check - Shows the bot detected message and countdown timer & restarts the captcha from the beginning
function botCheck(){
  if (sillySounds == true){
    document.getElementById('notes').style.display = 'none';
    playAudioError();
    document.getElementById('sfxBot').play();
  }
  resetGame();
  document.getElementById('BotDetected').style.display = 'block';  // Shows the bot message div and countdown
  document.getElementById('timer').innerHTML = 'NaNs';            // place holder before showing the countdown
  document.getElementById('curve-left').style.display = 'none'; // Shows sides of progress bar
  document.getElementById('curve-right').style.display = 'none'; // Shows sides of progress bar
  randomiseNumbers();                                            // Resets randomised no.s for next game
  displayNumbers();                                             // Display target number and total number
  countdown();                                                // Loads the countdown timer
}

// Countdown Timer - After it reaches 0 removes the bot message div
function countdown(){
  let countDownTimer = Ctimer;
  var BotCountDown = setInterval(function() {
    document.getElementById('timer').innerHTML = countDownTimer + 's';
    countDownTimer--;
    if(countDownTimer == -1) {
      clearInterval(BotCountDown);
      setTimeout(function(){document.getElementById('BotDetected').style.display = 'none';},BTimeout + Math.random()*2);
    }
  }, 1000);
}

// Resets the captcha game & progress bar to 0
function resetGame(){
  game = 0;
  prog = 0;
  document.getElementById('progress').style.width = '0%';
  document.getElementById('progAnimate').style.display = 'none';
  randomiseNumbers();
  skewTargetNumber();
  displayNumbers();
}

// AI code Created Confetti Explosion x 4 - Suggestions for modifying by Aeolus
function launchConfetti() {
  // Only bright primary and secondary colors
  let colors = [
    '#ff0000', // red
    '#00ff00', // lime
    '#0000ff', // blue
    '#ffff00', // yellow
    '#00ffff', // cyan
    '#ff00ff', // magenta
    '#ffffff', // white
    '#ffa500', // orange
    '#00bfff', // bright blue
    '#ff69b4'  // hot pink
  ];
  const container = document.getElementById('confetti-container');
  const confettiCount = 80;
  const centerX = 50; // percent, center of container horizontally
  const centerY = 50; // percent, center vertically

  // Define specific explosion points (not randomised)
  const explosionPoints = [
    { x: 0, y: 5 },   // 1 - left bottom corner (20% from left, 0% from bottom)
    { x: 100, y: 5 },   // 2 - right bottom corner (80% from left, 0% from bottom)
    { x: 25, y: 5 },  // 3 - left of middle (35% from left, 10% from bottom)
    { x: 75, y: 5 }   // 4 - right of middle (65% from left, 10% from bottom)
  ];

  // Repeat explosions 4 times at specific points, staggered, with an initial delay of 0.5s
  for (let burst = 0; burst < 4; burst++) {
    setTimeout(() => {
      // Use the specific explosion point for this burst (no randomisation)
      const explosionCenterX = explosionPoints[burst].x;
      const explosionCenterY = explosionPoints[burst].y;

      // Calculate angle towards center for the explosion
      const dx = centerX - explosionCenterX;
      const dy = centerY - explosionCenterY;
      const baseAngle = Math.atan2(dy, dx) * 180 / Math.PI; // in degrees

      for (let i = 0; i < confettiCount; i++) {
        const confetti = document.createElement('div');
        confetti.className = 'confetti';
        confetti.style.color = colors[Math.floor(Math.random() * colors.length)];

        // Cone angle always faces toward center
        const coneSpread = 80;
        const angleDeg = baseAngle - coneSpread / 2 + (coneSpread / (confettiCount - 1)) * i;
        const angleRad = angleDeg * (Math.PI / 180);

        // Start at explosion center
        confetti.style.left = explosionCenterX + '%';
        confetti.style.bottom = explosionCenterY + '%';
        confetti.style.top = '';
        confetti.style.position = 'absolute';
        confetti.style.transform = `rotate(${Math.random() * 360}deg) rotateX(${Math.random() * 360}deg) rotateY(${Math.random() * 360}deg)`;
        confetti.style.transition = `bottom 1.2s cubic-bezier(.25,.46,.45,.94), left 1.2s, transform 1.2s`;
        container.appendChild(confetti);

        // Randomise cone height and horizontal spread for each piece
        const maxConeRadius = 90;
        const minConeRadius = 10;
        const coneRadius = minConeRadius + Math.random() * (maxConeRadius - minConeRadius - 8);
        const horizontalSpread = 0.3 + Math.random() * 0.7;

        // Calculate peak position from explosion center, always facing center
        const peakLeft = explosionCenterX + Math.cos(angleRad) * coneRadius * horizontalSpread;
        const peakBottom = explosionCenterY + Math.sin(angleRad) * coneRadius + 10;

        setTimeout(() => {
          confetti.style.bottom = peakBottom + '%';
          confetti.style.left = peakLeft + '%';
          confetti.style.transform = `rotate(${Math.random() * 720}deg) rotateX(${Math.random() * 1440}deg) rotateY(${Math.random() * 1440}deg)`;
        }, 10);

        setTimeout(() => {
          confetti.style.transition = `bottom 4s cubic-bezier(.45,.05,.55,1), left 4s, transform 4s`;
          const fallLeft = peakLeft + (Math.random() - 0.5) * (coneRadius * 0.2);
          confetti.style.bottom = '0%';
          confetti.style.left = fallLeft + '%';
          confetti.style.transform = `rotate(${Math.random() * 1440}deg) rotateX(${Math.random() * 2880}deg) rotateY(${Math.random() * 2880}deg)`;
        }, 1300);

        // Fade out after landing for a while
        setTimeout(() => {
          confetti.style.opacity = '0';
        }, 9000); // Start fading after 9s (landed for 5s)

        // Remove after fade
        setTimeout(() => {
          confetti.remove();
        }, 10300); // Remove after fade completes (1s fade)
      }
    }, burst * 500); // Initial delay of 0.5s, then stagger each burst by 1s
  }
}

// Win conditions / effects / Sound of 'winning'
function win(){
  document.getElementById('count').disabled = true; // Disables button being pressed by user
  if(sillySounds == true){
    document.getElementById('sfxWin').play();
  }
  launchConfetti();
  document.getElementById('count').style.color = 'rgb(67, 172, 67)';
  document.getElementById('progress').style.width = '100%';
  setTimeout(captchaSuccess, 7000); // Completes captcha

}

// Captcha success - sends message to parent window
function captchaSuccess(){
  window.top.postMessage('success', '*');
}

// <!-- Created by Aeolus Archangel, project start date 2025 05 30. Functionally complete: 2025 06 08. Extra fluff - continual updates. For the sole purpose of a code Jam for <!REDACTED!> -->
</script>
</body>
</html>